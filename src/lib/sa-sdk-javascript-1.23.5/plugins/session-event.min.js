sensorsDataAnalytic201505.modules.SessionEvent=function(){"use strict";function t(t,e){if("track"!==t.type)return t;var s=e.sd,i=s._,o=s.saEvent.check,r=i.extend2Lev({properties:{}},t),n=e.currentProps,p=r.properties,h=r.event,c={};return i.each(n,function(t){if(i.isObject(t))t.events.indexOf(h)>-1&&o({properties:t.properties})&&(c=i.extend(c,t.properties));else if(i.isFunction(t)){var e=t({event:h,properties:p,data:r});i.isObject(e)&&!i.isEmptyObject(e)&&o({properties:e})&&(c=i.extend(c,e))}}),t.properties=i.extend(p,c),t}function e(e){var s=this;this.sd=e.sd,this.currentProps=e.customRegister,this.interceptor={addCustomProps:{priority:0,entry:function(e){return t(e,s),e}}}}function s(t){this.dataStage=new e(t)}function i(){this.sd=null,this.log=window.console&&window.console.log||function(){},this.customRegister=[]}function o(t){this.sd=t,this._=t._,this.cookie_value=null}function r(){this.registerProperties=null,this.store=null,this.sd=null,this._=null,this.log=window.console&&window.console.log||function(){},this.cookie_name="",this.prop={}}e.prototype.init=function(){},i.prototype.init=function(t){t?(this.sd=t,this._=t._,this.log=t.log,t.registerFeature(new s(this))):this.log("神策JS SDK未成功引入")},i.prototype.register=function(t){return this.sd?void(this._.isObject(t)&&this._.isArray(t.events)&&t.events.length>0&&this._.isObject(t.properties)&&!this._.isEmptyObject(t.properties)?this.customRegister.push(t):this.log("RegisterProperties: register 参数错误")):void this.log("神策JS SDK未成功引入")},i.prototype.hookRegister=function(t){return this.sd?void(this._.isFunction(t)?this.customRegister.push(t):this.log("RegisterProperties: hookRegister 参数错误")):void this.log("神策JS SDK未成功引入")},o.prototype.saveObjectVal=function(t,e){this._.isString(e)||(e=JSON.stringify(e)),1==this.sd.para.encrypt_cookie&&(e=this._.encrypt(e)),this._.cookie.isSupport()&&this._.cookie.set(t,e),this.cookie_value=e},o.prototype.readObjectVal=function(t){var e=this._.cookie.isSupport()?this._.cookie.get(t):this.cookie_value;return e?(e=this._.decryptIfNeeded(e),this._.safeJSONParse(e)):null};var n="sensorsdata2015jssdksession";r.prototype.init=function(t){if(!t||"object"!=typeof t)return void this.log("Session Event 插件初始化失败！");var e=this;this.sd=t,this._=t._,this.log=t.log,this.cookie_name=n+(t.para.sdk_id||""),this.registerProperties=new i,this.registerProperties.init(t),this.store=new o(t),this.registerProperties.hookRegister(function(){return e.addSessionID()})},r.prototype.addSessionID=function(){var t=+new Date;this.prop=this.store.readObjectVal(this.cookie_name)||{};var e=this.prop.first_session_time,s=this.prop.latest_session_time;if(!e||!s||e>t||s>t||t-e>432e5||t-s>18e5){var i=this._.UUID();this.prop={session_id:i.replace(/-/g,""),first_session_time:t,latest_session_time:t}}else this.prop.latest_session_time=t;return this.store.saveObjectVal(this.cookie_name,this.prop),{$event_session_id:this.prop.session_id}};var p=new r;return p.__constructor__=r,window.SensorsDataWebJSSDKPlugin&&"[object Object]"===Object.prototype.toString.call(window.SensorsDataWebJSSDKPlugin)?window.SensorsDataWebJSSDKPlugin.SessionEvent=window.SensorsDataWebJSSDKPlugin.SessionEvent||p:window.SensorsDataWebJSSDKPlugin={SessionEvent:p},p}();